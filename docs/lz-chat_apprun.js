import{a as L,b as C,c as k,d as O,e as N,f as w,g as S,h as M}from"./chunk-3O3ZY56E.js";import{a as R,b as T,c as _,d as H}from"./chunk-BRLW75YI.js";import"./chunk-N5LVMZ52.js";import{a as D}from"./chunk-ESA2JQH7.js";import{e as f}from"./chunk-DXN6V6KF.js";var E=class extends Map{set(e,n){return super.set(e,n),n}},m=class extends WeakMap{set(e,n){return super.set(e,n),n}};var et=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,rt=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,nt=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,st=/[\x01\x02]/g,W=(t,e,n)=>{let r=0;return t.join("").trim().replace(rt,(o,s,p,h)=>{let a=s+p.replace(nt,"=$2$1").trimEnd();return h.length&&(a+=n||et.test(s)?" /":"></"+s),"<"+a+">"}).replace(st,o=>o===""?"<!--"+e+r+++"-->":e+r++)};var ot=({firstChild:t,lastChild:e})=>{let n=document.createRange();return n.setStartAfter(t),n.setEndAfter(e),n.deleteContents(),t},j=(t,e)=>t.nodeType===111?1/e<0?e?ot(t):t.lastChild:e?t.valueOf():t.firstChild:t,P=t=>{let{firstChild:e,lastChild:n}=t;if(e===n)return n||t;let{childNodes:r}=t,o=[...r];return{ELEMENT_NODE:1,nodeType:111,firstChild:e,lastChild:n,valueOf(){return r.length!==o.length&&t.append(...o),t}}};var{isArray:$,prototype:ct}=Array,{indexOf:U}=ct;var{createDocumentFragment:it,createElement:at,createElementNS:lt,createTextNode:z,createTreeWalker:B,importNode:G}=new Proxy(document,{get:(t,e)=>t[e].bind(t)});var pt=t=>{let e=at("template");return e.innerHTML=t,e.content},v,ut=t=>{v||(v=lt("http://www.w3.org/2000/svg","svg")),v.innerHTML=t;let e=it();return e.append(...v.childNodes),e},q=(t,e)=>e?ut(t):pt(t);var mt=({childNodes:t},e)=>t[e],x=(t,e,n)=>L(t.parentNode,e,n,j,t),dt=t=>{let e,n,r=[],o=s=>{switch(typeof s){case"string":case"number":case"boolean":e!==s&&(e=s,n||(n=z("")),n.data=s,r=x(t,r,[n]));break;case"object":case"undefined":if(s==null){e!=s&&(e=s,r=x(t,r,[]));break}if($(s)){e=s,s.length===0?r=x(t,r,[]):typeof s[0]=="object"?r=x(t,r,s):o(String(s));break}e!==s&&"ELEMENT_NODE"in s&&(e=s,r=x(t,r,s.nodeType===11?[...s.childNodes]:[s]));break;case"function":o(s(t));break}};return o},ft=(t,e)=>{switch(e[0]){case"?":return O(t,e.slice(1),!1);case".":return S(t,e.slice(1));case"@":return N(t,"on"+e.slice(1));case"o":if(e[1]==="n")return N(t,e)}switch(e){case"ref":return w(t);case"aria":return C(t)}return k(t,e)};function F(t){let{type:e,path:n}=t,r=n.reduceRight(mt,this);return e==="node"?dt(r):e==="attr"?ft(r,t.name):M(r)}var A=t=>{let e=[],{parentNode:n}=t;for(;n;)e.push(U.call(n.childNodes,t)),t=n,{parentNode:n}=t;return e},b="is\xB5",I=new m,gt=/^(?:textarea|script|style|title|plaintext|xmp)$/,g=()=>({stack:[],entry:null,wire:null}),ht=(t,e)=>{let{content:n,updates:r}=bt(t,e);return{type:t,template:e,content:n,updates:r,wire:null}},xt=(t,e)=>{let n=t==="svg",r=W(e,b,n),o=q(r,n),s=B(o,129),p=[],h=e.length-1,a=0,c=`${b}${a}`;for(;a<h;){let i=s.nextNode();if(!i)throw`bad template: ${r}`;if(i.nodeType===8)i.data===c&&(p.push({type:"node",path:A(i)}),c=`${b}${++a}`);else{for(;i.hasAttribute(c);)p.push({type:"attr",path:A(i),name:i.getAttribute(c)}),i.removeAttribute(c),c=`${b}${++a}`;gt.test(i.localName)&&i.textContent.trim()===`<!--${c}-->`&&(i.textContent="",p.push({type:"text",path:A(i)}),c=`${b}${++a}`)}}return{content:o,nodes:p}},bt=(t,e)=>{let{content:n,nodes:r}=I.get(e)||I.set(e,xt(t,e)),o=G(n,!0),s=r.map(F,o);return{content:o,updates:s}},y=(t,{type:e,template:n,values:r})=>{let o=Y(t,r),{entry:s}=t;(!s||s.template!==n||s.type!==e)&&(t.entry=s=ht(e,n));let{content:p,updates:h,wire:a}=s;for(let c=0;c<o;c++)h[c](r[c]);return a||(s.wire=P(p))},Y=({stack:t},e)=>{let{length:n}=e;for(let r=0;r<n;r++){let o=e[r];o instanceof d?e[r]=y(t[r]||(t[r]=g()),o):$(o)?Y(t[r]||(t[r]=g()),o):t[r]=null}return n<t.length&&t.splice(n),n},d=class{constructor(e,n,r){this.type=e,this.template=n,this.values=r}};var J=t=>{let e=new m,n=r=>(o,...s)=>y(r,{type:t,template:o,values:s});return Object.assign((r,...o)=>new d(t,r,o),{for(r,o){let s=e.get(r)||e.set(r,new E);return s.get(o)||s.set(o,n(g()))},node:(r,...o)=>y(g(),new d(t,r,o)).valueOf()})},Z=new m,K=(t,e)=>{let n=typeof e=="function"?e():e,r=Z.get(t)||Z.set(t,g()),o=n instanceof d?y(r,n):n;return o!==r.wire&&(r.wire=o,t.replaceChildren(o.valueOf())),t},u=J("html"),zt=J("svg");var yt=u`
  <form class="box wide login" onSubmit=${t=>app.run("login",t)}>
    <input name="user" placeholder="Your nickname" />
  </form>
`,Q=yt;var Et=(t,e)=>u`
  <div
    class="message"
    data-self=${e.user.id===t}
    data-user=${e.user.name}
  >
    ${e.msg}
  </div>
`,X=Et;var vt=(t,e,n)=>u`
  <section class="box wide chat-box" data-status=${t}>
    ${n.map(r=>X(e.id,r))}
  </section>
  <form class="box wide message" onSubmit=${r=>app.run("send",r)}>
    <input name="msg" placeholder="message box..." />
  </form>
`,V=vt;f.debug("LZ Chat AppRun started!");app.render=K;var tt=document.getElementById("apprun"),$t={login(t,e){e.preventDefault();let n=e.target.elements.user.value;l.run("connecting"),D(R.URL).then(r=>{l.sock=r,l.sock.on("message",o=>{l.run("message",H(o))}),l.run("connected",{id:r.id,name:n})}).catch(r=>{f.error("WS error:",r),l.run("error")})},connecting(t){return{...t,status:"connecting"}},connected(t,e){return f.debug("AppRun connected:",e),{...t,status:"connected",user:e}},error(){return{...T,status:"error"}},send(t,e){e.preventDefault();let n=e.target.elements.msg.value,r={user:t.user,msg:n};e.target.elements.msg.value="",f.debug("AppRun send:",n),l.sock.emit("message",_(r)),l.run("message",r)},message(t,e){return f.debug("AppRun message:",e.user,e.msg),l.run("align"),{...t,messages:t.messages.concat(e)}},align(){let t=tt.querySelector(".chat-box");setTimeout(()=>{t.scrollTop<t.scrollHeight&&(t.scrollTop=t.scrollHeight)},0)}},Nt=t=>u`${t.status==="login"?Q:V(t.status,t.user,t.messages)}`,l=app.start(tt,T,Nt,$t);
/*! (c) Andrea Giammarchi - ISC */
//# sourceMappingURL=lz-chat_apprun.js.map
